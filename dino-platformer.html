<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>2D Platformer: DinoStamp</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: #222;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background: linear-gradient(to top, #4e8c4e 60%, #87ceeb 100%);
            box-shadow: 0 0 40px #000a;
        }
    </style>
</head>
<body>
<canvas id="game" width="960" height="540"></canvas>
<audio id="boom" src="https://cdn.pixabay.com/audio/2022/07/26/audio_124bfae7e2.mp3"></audio>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
const W = canvas.width, H = canvas.height;

// Game world
const gravity = 1.1;
const groundY = H - 80;
let cameraX = 0, cameraShake = 0, shakeTime = 0;

// Player (T-Rex)
const player = {
    x: 100,
    y: groundY - 80,
    vx: 0,
    vy: 0,
    w: 64,
    h: 80,
    speed: 6,
    jumping: false,
    facing: 1,
    color: '#6c3',
};

// Platforms/obstacles
const platforms = [
    {x: 0, y: groundY, w: 2000, h: 40},
    {x: 400, y: groundY - 120, w: 120, h: 20},
    {x: 700, y: groundY - 200, w: 100, h: 20},
    {x: 1000, y: groundY - 80, w: 80, h: 20},
    {x: 1300, y: groundY - 160, w: 120, h: 20},
    {x: 1600, y: groundY - 100, w: 100, h: 20},
];

// Controls
const keys = {};
window.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// Audio
const boom = document.getElementById('boom');

function playBoom() {
    boom.currentTime = 0;
    boom.play();
}

function shakeScreen() {
    cameraShake = 24;
    shakeTime = 12;
}

function drawPlayer() {
    // Simpel T-Rex sprite
    ctx.save();
    ctx.translate(player.x - cameraX, player.y);
    ctx.scale(player.facing, 1);
    ctx.fillStyle = player.color;
    ctx.fillRect(-player.w/2, -player.h, player.w, player.h);
    // Staart
    ctx.fillStyle = '#384';
    ctx.fillRect(-player.facing*player.w/2, -player.h/2, player.facing*30, 12);
    // Oog
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.arc(18, -player.h+18, 8, 0, Math.PI*2);
    ctx.fill();
    ctx.fillStyle = '#222';
    ctx.beginPath();
    ctx.arc(21, -player.h+18, 3, 0, Math.PI*2);
    ctx.fill();
    ctx.restore();
}

function drawPlatforms() {
    for (const p of platforms) {
        ctx.save();
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#964B00';
        ctx.fillRect(p.x - cameraX, p.y, p.w, p.h);
        ctx.restore();
    }
}

function drawUI() {
    ctx.save();
    ctx.font = 'bold 24px sans-serif';
    ctx.fillStyle = '#fff';
    ctx.fillText('DinoStamp: T-Rex Platformer', 24, 40);
    ctx.restore();
}

function updatePlayer() {
    // Horizontaal
    if (keys['a'] || keys['arrowleft']) {
        player.vx = -player.speed;
        player.facing = -1;
    } else if (keys['d'] || keys['arrowright']) {
        player.vx = player.speed;
        player.facing = 1;
    } else {
        player.vx = 0;
    }
    // Up/Down keys doen niets meer
    // Jump
    if ((keys[' '] || keys['z']) && !player.jumping) {
        player.vy = -22;
        player.jumping = true;
    }
    // Apply
    player.x += player.vx;
    player.y += player.vy;
    player.vy += gravity;
    // Collision (AABB, verbeterd)
    let onGround = false;
    for (const p of platforms) {
        // Check alleen als speler naar beneden beweegt
        if (
            player.x + player.w/2 > p.x &&
            player.x - player.w/2 < p.x + p.w &&
            player.y + player.h > p.y &&
            player.y + player.h - player.vy <= p.y &&
            player.vy >= 0
        ) {
            player.y = p.y - player.h;
            player.vy = 0;
            onGround = true;
        }
    }
    if (onGround) {
        if (player.jumping) {
            playBoom();
            shakeScreen();
        }
        player.jumping = false;
    } else {
        player.jumping = true;
    }
    // Camera volgen
    cameraX += ((player.x - 300) - cameraX) * 0.1;
    if (cameraX < 0) cameraX = 0;
}

function updateShake() {
    if (shakeTime > 0) {
        shakeTime--;
        cameraShake *= 0.85;
        if (cameraShake < 1) cameraShake = 0;
    } else {
        cameraShake = 0;
    }
}

function render() {
    ctx.save();
    if (cameraShake > 0) {
        ctx.translate(Math.random()*cameraShake - cameraShake/2, Math.random()*cameraShake - cameraShake/2);
    }
    ctx.clearRect(0, 0, W, H);
    drawPlatforms();
    drawPlayer();
    ctx.restore();
    drawUI();
}

function gameLoop() {
    updatePlayer();
    updateShake();
    render();
    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
